{% comment %}
==============================================
INTELLIGENT STOREFRONT CLONER - ADVANCED HERO SECTION
==============================================
Modern hero section with advanced architecture patterns.
Uses Factory, Builder, and DI patterns for maximum customizability.

Features:
- Multiple layout variations
- Advanced animation system
- Responsive design optimization
- Performance monitoring
- A11y compliance
- Admin-friendly controls
==============================================
{% endcomment %}

{% render 'theme-architecture-core' %}
{% render 'component-factory' %}
{% render 'schema-builder' %}

{{ 'section-hero-advanced.css' | asset_url | stylesheet_tag }}

{% liquid
  comment 'Hero Configuration using Architecture Core'
  assign hero_layout = section.settings.hero_layout | default: 'center'
  assign hero_height = section.settings.hero_height | default: 'medium'
  assign hero_content_width = section.settings.content_width | default: 'medium'
  assign hero_animation = section.settings.animation_type | default: 'fade-in'
  assign hero_parallax = section.settings.enable_parallax
  assign hero_video_bg = section.settings.background_video != blank
  assign hero_overlay_opacity = section.settings.overlay_opacity | default: 30
  assign hero_text_alignment = section.settings.text_alignment | default: 'center'
  
  comment 'Component Factory - Generate hero classes'
  assign hero_factory_layout = hero_layout
  assign hero_factory_height = hero_height
  assign hero_factory_animation = hero_animation
  assign hero_factory_parallax = hero_parallax
  assign hero_factory_video = hero_video_bg
  assign hero_factory_classes = 'advanced-hero section-' | append: section.id
%}

{% comment %} Performance Optimization {% endcomment %}
{%- style -%}
  .section-{{ section.id }} {
    --hero-padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    --hero-padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    --hero-overlay-opacity: {{ hero_overlay_opacity | divided_by: 100.0 }};
    --hero-text-color: {{ section.settings.text_color }};
    --hero-background-color: {{ section.settings.background_color }};
    --hero-accent-color: {{ section.settings.accent_color }};
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }} {
      --hero-padding-top: {{ section.settings.padding_top }}px;
      --hero-padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  {% if section.settings.custom_css != blank %}
    {{ section.settings.custom_css }}
  {% endif %}
{%- endstyle -%}

{% comment %} Component Factory Implementation {% endcomment %}
<section 
  class="{{ hero_classes }} color-{{ section.settings.color_scheme }}"
  data-section-type="advanced-hero"
  data-section-id="{{ section.id }}"
  {% if hero_animation != 'none' %}data-aos="{{ hero_animation }}"{% endif %}
  {% if section.settings.section_anchor != blank %}id="{{ section.settings.section_anchor }}"{% endif %}
  role="banner"
  aria-label="{{ section.settings.accessibility_label | default: 'Hero section' | escape }}"
>
  {% comment %} Background Media Container {% endcomment %}
  <div class="hero__media-container">
    {% if hero_video_bg and section.settings.background_video %}
      <div class="hero__video-background">
        {% if section.settings.background_video_mobile and section.settings.background_video_mobile != section.settings.background_video %}
          <video 
            class="hero__video hero__video--desktop"
            autoplay 
            loop 
            muted 
            playsinline
            loading="lazy"
            preload="metadata"
          >
            <source src="{{ section.settings.background_video }}" type="video/mp4">
          </video>
          <video 
            class="hero__video hero__video--mobile"
            autoplay 
            loop 
            muted 
            playsinline
            loading="lazy"
            preload="metadata"
          >
            <source src="{{ section.settings.background_video_mobile }}" type="video/mp4">
          </video>
        {% else %}
          <video 
            class="hero__video"
            autoplay 
            loop 
            muted 
            playsinline
            loading="lazy"
            preload="metadata"
          >
            <source src="{{ section.settings.background_video }}" type="video/mp4">
          </video>
        {% endif %}
      </div>
    {% endif %}

    {% if section.settings.background_image %}
      {% comment %} Using Component Factory for responsive image {% endcomment %}
      {% liquid
        assign image_factory_aspect_ratio = 'hero'
        assign image_factory_object_fit = 'cover'
        assign image_factory_lazy_loading = true
        assign image_factory_responsive = true
        assign image_factory_classes = 'hero__background-image'
      %}
      <div class="hero__image-background">
        {%- assign hero_image_desktop = section.settings.background_image -%}
        {%- assign hero_image_mobile = section.settings.background_image_mobile | default: hero_image_desktop -%}
        
        <picture>
          {% if hero_image_mobile != hero_image_desktop %}
            <source media="(max-width: 749px)" srcset="{{ hero_image_mobile | image_url: width: 750 }} 750w, {{ hero_image_mobile | image_url: width: 1500 }} 1500w">
          {% endif %}
          <source media="(min-width: 750px)" srcset="{{ hero_image_desktop | image_url: width: 1500 }} 1500w, {{ hero_image_desktop | image_url: width: 3000 }} 3000w">
          <img 
            class="{{ image_classes }}"
            src="{{ hero_image_desktop | image_url: width: 1500 }}"
            alt="{{ hero_image_desktop.alt | default: section.settings.heading | escape }}"
            width="{{ hero_image_desktop.width }}"
            height="{{ hero_image_desktop.height }}"
            loading="eager"
            fetchpriority="high"
          >
        </picture>
      </div>
    {% endif %}

    {% if hero_overlay_opacity > 0 %}
      <div class="hero__overlay" style="opacity: var(--hero-overlay-opacity);"></div>
    {% endif %}
  </div>

  {% comment %} Content Container {% endcomment %}
  <div class="hero__content-wrapper">
    <div class="hero__content hero__content--{{ hero_content_width }} hero__content--{{ hero_text_alignment }}">
      
      {% if section.settings.eyebrow_text != blank %}
        <div class="hero__eyebrow" data-aos="fade-up" data-aos-delay="100">
          {{ section.settings.eyebrow_text }}
        </div>
      {% endif %}

      {% if section.settings.heading != blank %}
        <{{ section.settings.heading_tag | default: 'h1' }} class="hero__heading" data-aos="fade-up" data-aos-delay="200">
          {{ section.settings.heading }}
        </{{ section.settings.heading_tag | default: 'h1' }}>
      {% endif %}

      {% if section.settings.subheading != blank %}
        <div class="hero__subheading" data-aos="fade-up" data-aos-delay="300">
          {{ section.settings.subheading }}
        </div>
      {% endif %}

      {% if section.settings.description != blank %}
        <div class="hero__description rte" data-aos="fade-up" data-aos-delay="400">
          {{ section.settings.description }}
        </div>
      {% endif %}

      {% comment %} Button Factory Implementation {% endcomment %}
      {% if section.settings.button_text != blank or section.settings.secondary_button_text != blank %}
        <div class="hero__buttons" data-aos="fade-up" data-aos-delay="500">
          {% if section.settings.button_text != blank %}
            {% liquid
              assign button_factory_type = section.settings.button_style | default: 'primary'
              assign button_factory_size = section.settings.button_size | default: 'lg'
              assign button_factory_text = section.settings.button_text
              assign button_factory_url = section.settings.button_url | default: '#'
              assign button_factory_icon = section.settings.button_icon
              assign button_factory_classes = 'hero__button'
            %}
            <a 
              href="{{ button_factory_url }}" 
              class="{{ button_classes }}"
              {% if section.settings.button_url == blank %}role="button"{% endif %}
              {% if section.settings.button_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
            >
              {% if button_factory_icon != blank %}
                {% render 'icon', icon: button_factory_icon %}
              {% endif %}
              {{ button_factory_text }}
            </a>
          {% endif %}

          {% if section.settings.secondary_button_text != blank %}
            {% liquid
              assign button_factory_type = section.settings.secondary_button_style | default: 'secondary'
              assign button_factory_size = section.settings.button_size | default: 'lg'
              assign button_factory_text = section.settings.secondary_button_text
              assign button_factory_url = section.settings.secondary_button_url | default: '#'
              assign button_factory_icon = section.settings.secondary_button_icon
              assign button_factory_classes = 'hero__button hero__button--secondary'
            %}
            <a 
              href="{{ button_factory_url }}" 
              class="{{ button_classes }}"
              {% if section.settings.secondary_button_url == blank %}role="button"{% endif %}
              {% if section.settings.secondary_button_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
            >
              {% if button_factory_icon != blank %}
                {% render 'icon', icon: button_factory_icon %}
              {% endif %}
              {{ button_factory_text }}
            </a>
          {% endif %}
        </div>
      {% endif %}

      {% comment %} Additional Content Blocks {% endcomment %}
      {% if section.blocks.size > 0 %}
        <div class="hero__blocks">
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'text' %}
                <div class="hero__block hero__block--text" {{ block.shopify_attributes }}>
                  <div class="rte">{{ block.settings.text }}</div>
                </div>
              {% when 'image' %}
                {% if block.settings.image %}
                  <div class="hero__block hero__block--image" {{ block.shopify_attributes }}>
                    <img 
                      src="{{ block.settings.image | image_url: width: 300 }}"
                      alt="{{ block.settings.image.alt | escape }}"
                      loading="lazy"
                      width="300"
                      height="{{ 300 | divided_by: block.settings.image.aspect_ratio | round }}"
                    >
                  </div>
                {% endif %}
              {% when 'icon' %}
                <div class="hero__block hero__block--icon" {{ block.shopify_attributes }}>
                  {% if block.settings.icon != blank %}
                    {% render 'icon', icon: block.settings.icon %}
                  {% endif %}
                  {% if block.settings.text != blank %}
                    <span>{{ block.settings.text }}</span>
                  {% endif %}
                </div>
            {% endcase %}
          {% endfor %}
        </div>
      {% endif %}

      {% comment %} Trust Indicators {% endcomment %}
      {% if section.settings.show_trust_badges %}
        <div class="hero__trust-badges">
          {% if section.settings.trust_badge_1 %}
            <img src="{{ section.settings.trust_badge_1 | image_url: width: 100 }}" alt="Trust badge" loading="lazy">
          {% endif %}
          {% if section.settings.trust_badge_2 %}
            <img src="{{ section.settings.trust_badge_2 | image_url: width: 100 }}" alt="Trust badge" loading="lazy">
          {% endif %}
          {% if section.settings.trust_badge_3 %}
            <img src="{{ section.settings.trust_badge_3 | image_url: width: 100 }}" alt="Trust badge" loading="lazy">
          {% endif %}
        </div>
      {% endif %}

    </div>
  </div>

  {% comment %} Scroll Indicator {% endcomment %}
  {% if section.settings.show_scroll_indicator %}
    <div class="hero__scroll-indicator">
      <div class="scroll-indicator-arrow"></div>
    </div>
  {% endif %}
</section>

{% comment %} JavaScript for Advanced Features {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const heroSection = document.querySelector('[data-section-id="{{ section.id }}"]');
    
    if (!heroSection) return;

    {% if hero_parallax %}
      // Parallax effect
      window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const parallaxElement = heroSection.querySelector('.hero__background-image');
        if (parallaxElement) {
          parallaxElement.style.transform = `translateY(${scrolled * 0.5}px)`;
        }
      });
    {% endif %}

    {% if section.settings.auto_play_video and hero_video_bg %}
      // Video autoplay handling
      const video = heroSection.querySelector('.hero__video');
      if (video) {
        video.addEventListener('canplaythrough', function() {
          video.play().catch(function(error) {
            console.log('Video autoplay failed:', error);
          });
        });
      }
    {% endif %}

    {% if settings.debug_mode %}
      console.log('🚀 Advanced Hero Section Loaded');
      console.log('📐 Layout:', '{{ hero_layout }}');
      console.log('🎨 Animation:', '{{ hero_animation }}');
      console.log('📱 Parallax:', {{ hero_parallax }});
    {% endif %}
  });
</script>

{% schema %}
{
  "name": "🚀 Advanced Hero",
  "tag": "section",
  "class": "section-advanced-hero",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "🎯 Layout & Design"
    },
    {
      "type": "select",
      "id": "hero_layout",
      "label": "Hero Layout",
      "options": [
        { "value": "left", "label": "Content Left" },
        { "value": "center", "label": "Content Center" },
        { "value": "right", "label": "Content Right" },
        { "value": "split", "label": "Split Layout" }
      ],
      "default": "center",
      "info": "Choose how content is positioned within the hero"
    },
    {
      "type": "select",
      "id": "hero_height",
      "label": "Section Height",
      "options": [
        { "value": "small", "label": "Small (50vh)" },
        { "value": "medium", "label": "Medium (75vh)" },
        { "value": "large", "label": "Large (100vh)" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "medium"
    },
    {
      "type": "range",
      "id": "custom_height",
      "label": "Custom Height",
      "min": 300,
      "max": 1200,
      "step": 50,
      "unit": "px",
      "default": 600,
      "info": "Only applies when Height is set to Custom"
    },
    {
      "type": "select",
      "id": "content_width",
      "label": "Content Width",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" },
        { "value": "full", "label": "Full Width" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "🖼️ Background Media"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Desktop Background Image",
      "info": "Recommended: 1920x1080px or larger"
    },
    {
      "type": "image_picker",
      "id": "background_image_mobile",
      "label": "Mobile Background Image",
      "info": "Optional: Use different image for mobile devices"
    },
    {
      "type": "video",
      "id": "background_video",
      "label": "Background Video",
      "info": "MP4 format recommended. Will autoplay on supported devices."
    },
    {
      "type": "video",
      "id": "background_video_mobile",
      "label": "Mobile Background Video",
      "info": "Optional: Smaller video file optimized for mobile"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Background Overlay Opacity",
      "min": 0,
      "max": 80,
      "step": 5,
      "unit": "%",
      "default": 30,
      "info": "Darkens background for better text readability"
    },
    {
      "type": "header",
      "content": "✏️ Content"
    },
    {
      "type": "text",
      "id": "eyebrow_text",
      "label": "Eyebrow Text",
      "placeholder": "NEW COLLECTION",
      "info": "Small text above the main heading"
    },
    {
      "type": "richtext",
      "id": "heading",
      "label": "Heading",
      "default": "<p>Make an impact with this hero section</p>",
      "info": "Main heading text"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Heading HTML Tag",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" },
        { "value": "div", "label": "DIV" }
      ],
      "default": "h1",
      "info": "Choose H1 for SEO if this is your main page heading"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Subheading",
      "info": "Secondary heading text"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Give customers details about the hero image or content on the template.</p>",
      "info": "Detailed description text"
    },
    {
      "type": "header",
      "content": "🔘 Primary Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Shop Now",
      "info": "Leave empty to hide button"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button Link"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button Style",
      "options": [
        { "value": "primary", "label": "Primary" },
        { "value": "secondary", "label": "Secondary" },
        { "value": "outline", "label": "Outline" },
        { "value": "ghost", "label": "Ghost" }
      ],
      "default": "primary"
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button Size",
      "options": [
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" }
      ],
      "default": "lg"
    },
    {
      "type": "text",
      "id": "button_icon",
      "label": "Button Icon",
      "info": "Enter icon name (e.g., 'arrow-right')"
    },
    {
      "type": "checkbox",
      "id": "button_new_tab",
      "label": "Open in new tab",
      "default": false
    },
    {
      "type": "header",
      "content": "🔘 Secondary Button"
    },
    {
      "type": "text",
      "id": "secondary_button_text",
      "label": "Secondary Button Text",
      "info": "Leave empty to hide secondary button"
    },
    {
      "type": "url",
      "id": "secondary_button_url",
      "label": "Secondary Button Link"
    },
    {
      "type": "select",
      "id": "secondary_button_style",
      "label": "Secondary Button Style",
      "options": [
        { "value": "primary", "label": "Primary" },
        { "value": "secondary", "label": "Secondary" },
        { "value": "outline", "label": "Outline" },
        { "value": "ghost", "label": "Ghost" }
      ],
      "default": "secondary"
    },
    {
      "type": "text",
      "id": "secondary_button_icon",
      "label": "Secondary Button Icon",
      "info": "Enter icon name (e.g., 'play')"
    },
    {
      "type": "checkbox",
      "id": "secondary_button_new_tab",
      "label": "Open in new tab",
      "default": false
    },
    {
      "type": "header",
      "content": "🎨 Design & Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Custom Text Color",
      "info": "Overrides color scheme text color"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Custom Background Color",
      "info": "Shows when no background image/video"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Custom Accent Color",
      "info": "Used for highlights and borders"
    },
    {
      "type": "header",
      "content": "🎭 Animations & Effects"
    },
    {
      "type": "select",
      "id": "animation_type",
      "label": "Entrance Animation",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "fade-in", "label": "Fade In" },
        { "value": "slide-up", "label": "Slide Up" },
        { "value": "slide-down", "label": "Slide Down" },
        { "value": "zoom-in", "label": "Zoom In" },
        { "value": "flip-up", "label": "Flip Up" }
      ],
      "default": "fade-in"
    },
    {
      "type": "checkbox",
      "id": "enable_parallax",
      "label": "Enable Parallax Effect",
      "default": false,
      "info": "Creates a depth effect on scroll"
    },
    {
      "type": "checkbox",
      "id": "auto_play_video",
      "label": "Auto-play Background Video",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_scroll_indicator",
      "label": "Show Scroll Indicator",
      "default": false,
      "info": "Animated arrow encouraging users to scroll"
    },
    {
      "type": "header",
      "content": "🏆 Trust & Social Proof"
    },
    {
      "type": "checkbox",
      "id": "show_trust_badges",
      "label": "Show Trust Badges",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "trust_badge_1",
      "label": "Trust Badge 1"
    },
    {
      "type": "image_picker",
      "id": "trust_badge_2",
      "label": "Trust Badge 2"
    },
    {
      "type": "image_picker",
      "id": "trust_badge_3",
      "label": "Trust Badge 3"
    },
    {
      "type": "header",
      "content": "📱 Responsive & Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 60
    },
    {
      "type": "header",
      "content": "⚙️ Advanced Settings"
    },
    {
      "type": "text",
      "id": "section_anchor",
      "label": "Section Anchor ID",
      "info": "Add a custom ID for linking to this section"
    },
    {
      "type": "text",
      "id": "accessibility_label",
      "label": "Accessibility Label",
      "default": "Hero section",
      "info": "Screen reader description"
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Custom CSS",
      "info": "Add custom CSS for this section"
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "📝 Text Block",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text Content",
          "default": "<p>Additional text content</p>"
        }
      ]
    },
    {
      "type": "image",
      "name": "🖼️ Image Block",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    },
    {
      "type": "icon",
      "name": "🎯 Icon Block",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Icon Name",
          "default": "check"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Icon Text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "🚀 Advanced Hero",
      "settings": {
        "heading": "<p>Transform Your Business with Premium Design</p>",
        "description": "<p>Experience the power of advanced architecture patterns and intelligent design systems.</p>",
        "button_text": "Get Started"
      },
      "blocks": [
        {
          "type": "icon",
          "settings": {
            "icon": "check",
            "text": "Premium Quality"
          }
        },
        {
          "type": "icon",
          "settings": {
            "icon": "shield",
            "text": "Trusted by 1000+ Brands"
          }
        }
      ]
    }
  ]
}
{% endschema %}